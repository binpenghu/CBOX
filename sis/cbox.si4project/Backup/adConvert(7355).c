
/****************************************************************************
// Copyright (c) 2017
//
// @Module        
// @Filename      
// @Project       
// @Author        HBP
//----------------------------------------------------------------------------
// @Controller    STM8S
//
// @Compiler      IAR
//
// @Description   
//
//----------------------------------------------------------------------------
// @Date          2017
// @Version       V1.0
****************************************************************************/

//****************************************************************************
// @Project Includes
//****************************************************************************
#include "adConvert.h"
//****************************************************************************
// @Macros
//****************************************************************************

//****************************************************************************
// @Defines
//****************************************************************************

//****************************************************************************
// @Typedefs
//****************************************************************************





//****************************************************************************
// @Imported Global Variables
//****************************************************************************

//****************************************************************************
// @Global Variables
//****************************************************************************
const float chargeBatCurOffset = 0.175;   //unit 0.1A
const float chargeUsbCurOffset = 0.025;   //unit 0.1A
const float batterVoltOffset = 0.7; 	  //unit 0.1V
const float inVoltOffset = 0.7; 	  	  //unit 0.1V

//AD_IPNUT_T adInputData = {0};


//****************************************************************************
// @Prototypes Of Static Functions
//****************************************************************************

//****************************************************************************
// @Prototypes Of Global Functions
//****************************************************************************
/******************************************************************************
 *  Function:
 *  Parameters: None
 *  Returns: None
 *  Description:   
 ******************************************************************************/

/******************************************************************************
 *	Function:
 *	Parameters: None
 *	Returns: None
 *	Description:   
 ******************************************************************************/

u16 vBatBuf[BUF_LENTH];
u16 vInBuf[BUF_LENTH];
u16 iBatBuf[BUF_LENTH];
u16 iUsbBuf[BUF_LENTH];
BUF_STA_T vBatBufSta = {0,0,0,0};
BUF_STA_T vInBufSta = {0,0,0,0};
BUF_STA_T iBatBufSta = {0,0,0,0};
BUF_STA_T iUsbBufSta = {0,0,0,0};


u8 buffer(u16 *buf,BUF_STA_T *bufsta,u16 inVal)
{
	u8 j=0;
	buf[bufsta->bufCnt] = inVal; 
	if (bufsta->bufCnt==BUF_LENTH-1 || bufsta->bufSta == 1)
	{
		for (j=0;j<BUF_LENTH;j++)
		{
			bufsta->total += buf[j];
		}
		bufsta->avg = bufsta->total/BUF_LENTH;
		//bufsta->avg = bufsta.total<<2;
		bufsta->bufSta =1;
		return 0;
	}
	bufsta->bufCnt = bufsta->bufCnt<BUF_LENTH?bufsta->bufCnt++:0;
	return 1;
}
 

/******************************************************************************
 *  Function:
 *  Parameters: None
 *  Returns: None
 *  Description:   
 ******************************************************************************/
u16 vBackConvert(u16 adval)
{
	u16 temp=0;
	temp = (u16)(adval*batterVoltOffset); //0.1v
	return temp;
}

u16 vInConvert(u16 adval)
{
	u16 temp=0;
	temp = (u16)(adval*inVoltOffset);//0.1v
	return temp;

}

u16 iBackConvert(u16 adval)
{
	u16 temp=0;
	temp = (u16)(adval *chargeBatCurOffset); // 0.1A
	return temp;
}

u16 iUsbConvert(u16 adval)
{
	u16 temp=0;
	temp = (u16)(adval *chargeUsbCurOffset); // 0.1A
	return temp;
}

/******************************************************************************
 *  Function:
 *  Parameters: None
 *  Returns: None
 *  Description:  four channels ad convert. each 25ms period, 
 ******************************************************************************/

 
//****************************************************************************
// @Interrupt Vectors
//****************************************************************************

/*
 *######################################################################
 *                           End of File
 *######################################################################
 */






